# HG changeset patch
# User Matti Picus
# Date 1703495167 -7200
#      Mon Dec 25 11:06:07 2023 +0200
# Branch py3.9
# Node ID 28e6fa4cc469dcc16df150e8f476280edfe6af2c
# Parent  9259ae0f7702c75d14925d2f776ebce0ed324b9e
newer clang on older macos target needs this (should upstream)

diff -r 9259ae0f7702 -r 28e6fa4cc469 pypy/module/_hpy_universal/_vendored/hpy/debug/src/memprotect.c
--- a/pypy/module/_hpy_universal/_vendored/hpy/debug/src/memprotect.c	Sun Dec 24 21:15:00 2023 +0200
+++ b/pypy/module/_hpy_universal/_vendored/hpy/debug/src/memprotect.c	Mon Dec 25 11:06:07 2023 +0200
@@ -11,6 +11,12 @@
 #include <sys/mman.h>
 #include <string.h>
 
+// For macos < 11
+#if defined(MAP_ANON) && !defined(MAP_ANONYMOUS)
+#define MAP_ANONYMOUS MAP_ANON
+#endif
+
+
 void *raw_data_copy(const void* data, HPy_ssize_t size, bool write_protect) {
     void* new_ptr;
     new_ptr = mmap(NULL, size, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);

# HG changeset patch
# Date 1703510463 -7200
#      Mon Dec 25 15:21:03 2023 +0200
# Branch py3.9
# Node ID bedf30f142e821a853b50fd75e6c4195225dd170
# Parent  eb0e00489863414022d3dadbafdd9d2fb6ad8c0f
bumpy minimum macos version support to 10.13 for hpy

diff -r eb0e00489863 -r bedf30f142e8 lib_pypy/_sysconfigdata.py
--- a/lib_pypy/_sysconfigdata.py    Mon Dec 25 13:47:55 2023 +0200
+++ b/lib_pypy/_sysconfigdata.py    Mon Dec 25 15:21:03 2023 +0200
@@ -97,5 +97,5 @@
     #
     # In any case, keep this in sync with DARWIN_VERSION_MIN in
     # rpython/translator/platform/darwin.py and Lib/_osx_support.py
-    build_time_vars['MACOSX_DEPLOYMENT_TARGET'] = '10.9'
+    build_time_vars['MACOSX_DEPLOYMENT_TARGET'] = '10.13'
 
diff -r eb0e00489863 -r bedf30f142e8 rpython/translator/platform/darwin.py
--- a/rpython/translator/platform/darwin.py Mon Dec 25 13:47:55 2023 +0200
+++ b/rpython/translator/platform/darwin.py Mon Dec 25 15:21:03 2023 +0200
@@ -14,7 +14,7 @@
 # Keep in sync with MACOSX_DEPLOYMENT_TARGET, for pypy see
 # lib_pypy/_sysconfigdata.py
 #
-DARWIN_VERSION_MIN = '-mmacosx-version-min=10.9'
+DARWIN_VERSION_MIN = '-mmacosx-version-min=10.13'
 
 class Darwin(posix.BasePosix):
     name = "darwin"

